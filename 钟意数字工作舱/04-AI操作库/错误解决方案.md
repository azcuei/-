# 错误解决方案库

## 📝 使用说明
这个文件收集了常见的错误和问题及其解决方案，包括Python、Web开发、数据库、网络等各个领域的错误处理经验。每个解决方案都经过验证，可以直接参考使用。

## 🐍 Python错误

### 常见语法错误
```python
# 错误1: IndentationError - 缩进错误
# 错误代码:
def function():
print("Hello")  # 缩进不正确

# 解决方案:
def function():
    print("Hello")  # 使用4个空格缩进

# 错误2: SyntaxError - 语法错误
# 错误代码:
if x = 5:  # 使用赋值而不是比较

# 解决方案:
if x == 5:  # 使用比较操作符

# 错误3: NameError - 变量未定义
# 错误代码:
print(undefined_variable)

# 解决方案:
undefined_variable = "Hello"
print(undefined_variable)
```

### 运行时错误
```python
# 错误1: TypeError - 类型错误
# 错误代码:
result = "Hello" + 5

# 解决方案:
result = "Hello" + str(5)  # 转换为字符串
# 或者
result = f"Hello {5}"  # 使用f-string

# 错误2: ValueError - 值错误
# 错误代码:
number = int("abc")

# 解决方案:
try:
    number = int("abc")
except ValueError:
    print("无法转换为整数")
    number = 0

# 错误3: KeyError - 键错误
# 错误代码:
data = {"name": "John"}
print(data["age"])

# 解决方案:
# 方法1: 使用get方法
age = data.get("age", "未知")

# 方法2: 使用try-except
try:
    age = data["age"]
except KeyError:
    age = "未知"

# 方法3: 使用in检查
if "age" in data:
    age = data["age"]
else:
    age = "未知"
```

### 文件操作错误
```python
# 错误1: FileNotFoundError - 文件未找到
# 错误代码:
with open("nonexistent.txt", "r") as f:
    content = f.read()

# 解决方案:
import os

if os.path.exists("nonexistent.txt"):
    with open("nonexistent.txt", "r") as f:
        content = f.read()
else:
    print("文件不存在")

# 或者使用try-except
try:
    with open("nonexistent.txt", "r") as f:
        content = f.read()
except FileNotFoundError:
    print("文件不存在")

# 错误2: PermissionError - 权限错误
# 错误代码:
with open("/root/file.txt", "w") as f:
    f.write("Hello")

# 解决方案:
try:
    with open("/root/file.txt", "w") as f:
        f.write("Hello")
except PermissionError:
    print("没有写入权限")
    # 尝试写入用户目录
    import os
    home_dir = os.path.expanduser("~")
    file_path = os.path.join(home_dir, "file.txt")
    with open(file_path, "w") as f:
        f.write("Hello")
```

## 🌐 Web开发错误

### HTTP错误
```python
# 错误1: 连接超时
# 错误代码:
import requests
response = requests.get("https://slow-website.com", timeout=1)

# 解决方案:
try:
    response = requests.get("https://slow-website.com", timeout=10)
    response.raise_for_status()
except requests.exceptions.Timeout:
    print("请求超时")
except requests.exceptions.ConnectionError:
    print("连接错误")
except requests.exceptions.HTTPError as e:
    print(f"HTTP错误: {e}")

# 错误2: SSL证书错误
# 错误代码:
response = requests.get("https://self-signed-cert.com")

# 解决方案:
# 方法1: 禁用SSL验证（不推荐用于生产环境）
response = requests.get("https://self-signed-cert.com", verify=False)

# 方法2: 使用自定义证书
response = requests.get("https://self-signed-cert.com", verify="/path/to/cert.pem")

# 方法3: 使用requests.Session
session = requests.Session()
session.verify = False
response = session.get("https://self-signed-cert.com")
```

### 数据库错误
```python
# 错误1: 连接失败
# 错误代码:
import sqlite3
conn = sqlite3.connect("database.db")

# 解决方案:
try:
    conn = sqlite3.connect("database.db")
    cursor = conn.cursor()
except sqlite3.Error as e:
    print(f"数据库错误: {e}")
finally:
    if conn:
        conn.close()

# 错误2: 表不存在
# 错误代码:
cursor.execute("SELECT * FROM nonexistent_table")

# 解决方案:
try:
    cursor.execute("SELECT * FROM nonexistent_table")
except sqlite3.OperationalError as e:
    print(f"表不存在: {e}")
    # 创建表
    cursor.execute("""
        CREATE TABLE IF NOT EXISTS users (
            id INTEGER PRIMARY KEY,
            name TEXT NOT NULL
        )
    """)

# 错误3: 数据完整性错误
# 错误代码:
cursor.execute("INSERT INTO users (id, name) VALUES (1, NULL)")

# 解决方案:
try:
    cursor.execute("INSERT INTO users (id, name) VALUES (1, NULL)")
except sqlite3.IntegrityError as e:
    print(f"数据完整性错误: {e}")
    # 提供默认值
    cursor.execute("INSERT INTO users (id, name) VALUES (1, 'Unknown')")
```

## 🔧 环境配置错误

### 依赖安装错误
```bash
# 错误1: 包版本冲突
# 错误信息:
ERROR: pip's dependency resolver does not currently have a strategy to resolve dependency conflicts

# 解决方案:
# 方法1: 使用虚拟环境
python -m venv myenv
source myenv/bin/activate  # Linux/Mac
# myenv\Scripts\activate  # Windows
pip install package_name

# 方法2: 升级pip
pip install --upgrade pip

# 方法3: 使用pip-tools
pip install pip-tools
pip-compile requirements.in
pip-sync requirements.txt

# 错误2: 权限错误
# 错误信息:
ERROR: Could not install packages due to an EnvironmentError: [Errno 13] Permission denied

# 解决方案:
# 方法1: 使用用户安装
pip install --user package_name

# 方法2: 使用虚拟环境
python -m venv myenv
source myenv/bin/activate
pip install package_name

# 方法3: 使用sudo（不推荐）
sudo pip install package_name
```

### 环境变量错误
```python
# 错误1: 环境变量未设置
# 错误代码:
import os
api_key = os.environ["API_KEY"]

# 解决方案:
import os
api_key = os.environ.get("API_KEY")
if not api_key:
    print("API_KEY环境变量未设置")
    api_key = "default_key"

# 错误2: 环境变量类型错误
# 错误代码:
port = int(os.environ["PORT"])

# 解决方案:
try:
    port = int(os.environ.get("PORT", "8000"))
except ValueError:
    print("PORT环境变量不是有效的整数")
    port = 8000
```

## 🎨 前端开发错误

### JavaScript错误
```javascript
// 错误1: 未定义变量
// 错误代码:
console.log(undefinedVariable);

// 解决方案:
// 方法1: 检查变量是否存在
if (typeof undefinedVariable !== 'undefined') {
    console.log(undefinedVariable);
}

// 方法2: 使用默认值
console.log(undefinedVariable || 'default value');

// 错误2: 异步操作错误
// 错误代码:
fetch('/api/data')
    .then(response => response.json())
    .then(data => console.log(data));

// 解决方案:
fetch('/api/data')
    .then(response => {
        if (!response.ok) {
            throw new Error('网络响应不正常');
        }
        return response.json();
    })
    .then(data => console.log(data))
    .catch(error => console.error('错误:', error));

// 错误3: DOM元素未找到
// 错误代码:
document.getElementById('nonexistent').innerHTML = 'Hello';

// 解决方案:
const element = document.getElementById('nonexistent');
if (element) {
    element.innerHTML = 'Hello';
} else {
    console.log('元素未找到');
}
```

### CSS错误
```css
/* 错误1: 选择器语法错误 */
/* 错误代码: */
div, p, {  /* 多余的逗号 */
    color: red;
}

/* 解决方案: */
div, p {
    color: red;
}

/* 错误2: 属性值错误 */
/* 错误代码: */
div {
    color: redd;  /* 拼写错误 */
}

/* 解决方案: */
div {
    color: red;
}

/* 错误3: 单位错误 */
/* 错误代码: */
div {
    width: 100;  /* 缺少单位 */
}

/* 解决方案: */
div {
    width: 100px;
}
```

## 🔍 调试技巧

### 日志记录
```python
import logging

# 配置日志
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('debug.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)

# 使用日志
try:
    result = risky_operation()
    logger.info(f"操作成功: {result}")
except Exception as e:
    logger.error(f"操作失败: {e}", exc_info=True)
```

### 异常处理
```python
def safe_operation(data):
    """安全的操作函数"""
    try:
        # 验证输入
        if not data:
            raise ValueError("数据不能为空")

        # 执行操作
        result = process_data(data)

        # 验证结果
        if not result:
            raise RuntimeError("处理结果为空")

        return result

    except ValueError as e:
        logger.error(f"输入验证失败: {e}")
        return None
    except RuntimeError as e:
        logger.error(f"运行时错误: {e}")
        return None
    except Exception as e:
        logger.error(f"未知错误: {e}", exc_info=True)
        return None
```

### 性能调试
```python
import time
import cProfile
import pstats
from functools import wraps

def timing(func):
    """性能计时装饰器"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        start_time = time.time()
        result = func(*args, **kwargs)
        end_time = time.time()
        print(f"{func.__name__} 执行时间: {end_time - start_time:.4f}秒")
        return result
    return wrapper

def profile(func):
    """性能分析装饰器"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        profiler = cProfile.Profile()
        profiler.enable()
        result = func(*args, **kwargs)
        profiler.disable()

        stats = pstats.Stats(profiler)
        stats.sort_stats('cumulative')
        stats.print_stats(10)

        return result
    return wrapper

# 使用示例
@timing
@profile
def slow_function():
    time.sleep(1)
    return "完成"
```

## 🛠️ 工具和资源

### 调试工具
```python
# 使用pdb调试器
import pdb

def debug_function():
    x = 1
    y = 2
    pdb.set_trace()  # 设置断点
    result = x + y
    return result

# 使用ipdb（更友好的调试器）
import ipdb

def debug_function():
    x = 1
    y = 2
    ipdb.set_trace()  # 设置断点
    result = x + y
    return result
```

### 错误监控
```python
import sentry_sdk

# 配置Sentry错误监控
sentry_sdk.init("YOUR_DSN_HERE")

# 手动捕获异常
try:
    risky_operation()
except Exception as e:
    sentry_sdk.capture_exception(e)
```

## 📋 错误预防

### 输入验证
```python
def validate_input(data):
    """输入验证函数"""
    if not isinstance(data, dict):
        raise TypeError("输入必须是字典类型")

    required_fields = ['name', 'email', 'age']
    for field in required_fields:
        if field not in data:
            raise ValueError(f"缺少必需字段: {field}")

    if not isinstance(data['age'], int) or data['age'] < 0:
        raise ValueError("年龄必须是正整数")

    if '@' not in data['email']:
        raise ValueError("邮箱格式不正确")

    return True
```

### 资源管理
```python
from contextlib import contextmanager

@contextmanager
def safe_file_operation(filename, mode='r'):
    """安全的文件操作上下文管理器"""
    file = None
    try:
        file = open(filename, mode)
        yield file
    except Exception as e:
        print(f"文件操作错误: {e}")
        raise
    finally:
        if file:
            file.close()
```

## 🔄 更新记录

### 版本历史
- **v1.0** (2025-01-07): 初始版本，包含常见错误解决方案
- **v1.1** (计划中): 增加更多专业领域错误处理
- **v1.2** (计划中): 优化解决方案和添加最佳实践

### 贡献指南
- 分享遇到的错误和解决方案
- 提供使用反馈
- 建议改进方案
- 参与社区讨论

**错误解决方案库持续更新中...** 🚀
