# æµè§ˆå™¨è‡ªåŠ¨åŒ–é…ç½®

## ğŸ“ ä½¿ç”¨è¯´æ˜
è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†æµè§ˆå™¨è‡ªåŠ¨åŒ–çš„é…ç½®æ–¹æ³•å’Œä»£ç ç‰‡æ®µï¼Œæ”¯æŒSeleniumã€Playwrightç­‰ä¸»æµè‡ªåŠ¨åŒ–å·¥å…·ã€‚æ¯ä¸ªé…ç½®éƒ½ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

## ğŸš€ Seleniumé…ç½®

### åŸºç¡€é…ç½®
```python
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.action_chains import ActionChains
import time

# Chromeæµè§ˆå™¨é…ç½®
def setup_chrome_driver(headless=False, window_size=(1920, 1080)):
    """è®¾ç½®Chromeæµè§ˆå™¨é©±åŠ¨"""
    options = Options()

    if headless:
        options.add_argument('--headless')

    # åŸºç¡€é…ç½®
    options.add_argument(f'--window-size={window_size[0]},{window_size[1]}')
    options.add_argument('--no-sandbox')
    options.add_argument('--disable-dev-shm-usage')
    options.add_argument('--disable-gpu')
    options.add_argument('--disable-extensions')

    # ç”¨æˆ·ä»£ç†
    options.add_argument('--user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36')

    # ç¦ç”¨å›¾ç‰‡åŠ è½½ï¼ˆæé«˜é€Ÿåº¦ï¼‰
    prefs = {
        "profile.managed_default_content_settings.images": 2,
        "profile.default_content_setting_values.notifications": 2
    }
    options.add_experimental_option("prefs", prefs)

    driver = webdriver.Chrome(options=options)
    driver.implicitly_wait(10)

    return driver

# Firefoxæµè§ˆå™¨é…ç½®
def setup_firefox_driver(headless=False):
    """è®¾ç½®Firefoxæµè§ˆå™¨é©±åŠ¨"""
    from selenium.webdriver.firefox.options import Options

    options = Options()

    if headless:
        options.add_argument('--headless')

    options.add_argument('--width=1920')
    options.add_argument('--height=1080')

    driver = webdriver.Firefox(options=options)
    driver.implicitly_wait(10)

    return driver
```

### å…ƒç´ å®šä½
```python
class ElementLocator:
    def __init__(self, driver):
        self.driver = driver
        self.wait = WebDriverWait(driver, 10)

    def find_element_safe(self, locator, timeout=10):
        """å®‰å…¨æŸ¥æ‰¾å…ƒç´ """
        try:
            element = WebDriverWait(self.driver, timeout).until(
                EC.presence_of_element_located(locator)
            )
            return element
        except Exception as e:
            print(f"å…ƒç´ æœªæ‰¾åˆ°: {locator}, é”™è¯¯: {e}")
            return None

    def find_elements_safe(self, locator, timeout=10):
        """å®‰å…¨æŸ¥æ‰¾å¤šä¸ªå…ƒç´ """
        try:
            elements = WebDriverWait(self.driver, timeout).until(
                EC.presence_of_all_elements_located(locator)
            )
            return elements
        except Exception as e:
            print(f"å…ƒç´ æœªæ‰¾åˆ°: {locator}, é”™è¯¯: {e}")
            return []

    def click_element(self, locator, timeout=10):
        """ç‚¹å‡»å…ƒç´ """
        element = self.find_element_safe(locator, timeout)
        if element:
            try:
                self.wait.until(EC.element_to_be_clickable(locator))
                element.click()
                return True
            except Exception as e:
                print(f"ç‚¹å‡»å¤±è´¥: {e}")
                return False
        return False

    def input_text(self, locator, text, timeout=10):
        """è¾“å…¥æ–‡æœ¬"""
        element = self.find_element_safe(locator, timeout)
        if element:
            try:
                element.clear()
                element.send_keys(text)
                return True
            except Exception as e:
                print(f"è¾“å…¥å¤±è´¥: {e}")
                return False
        return False
```

### é¡µé¢æ“ä½œ
```python
class PageOperations:
    def __init__(self, driver):
        self.driver = driver
        self.actions = ActionChains(driver)

    def scroll_to_element(self, element):
        """æ»šåŠ¨åˆ°å…ƒç´ """
        self.driver.execute_script("arguments[0].scrollIntoView(true);", element)
        time.sleep(1)

    def scroll_to_bottom(self):
        """æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨"""
        self.driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")
        time.sleep(1)

    def scroll_to_top(self):
        """æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨"""
        self.driver.execute_script("window.scrollTo(0, 0);")
        time.sleep(1)

    def switch_to_new_tab(self):
        """åˆ‡æ¢åˆ°æ–°æ ‡ç­¾é¡µ"""
        self.driver.switch_to.window(self.driver.window_handles[-1])

    def close_current_tab(self):
        """å…³é—­å½“å‰æ ‡ç­¾é¡µ"""
        self.driver.close()
        self.driver.switch_to.window(self.driver.window_handles[0])

    def wait_for_page_load(self, timeout=30):
        """ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ"""
        WebDriverWait(self.driver, timeout).until(
            lambda driver: driver.execute_script("return document.readyState") == "complete"
        )

    def take_screenshot(self, filename):
        """æˆªå›¾"""
        self.driver.save_screenshot(filename)
        print(f"æˆªå›¾å·²ä¿å­˜: {filename}")
```

## ğŸ­ Playwrighté…ç½®

### åŸºç¡€é…ç½®
```python
from playwright.sync_api import sync_playwright
import asyncio
from playwright.async_api import async_playwright

# åŒæ­¥æ¨¡å¼é…ç½®
def setup_playwright_sync(browser_type='chromium', headless=False):
    """è®¾ç½®PlaywrightåŒæ­¥æ¨¡å¼"""
    playwright = sync_playwright().start()

    if browser_type == 'chromium':
        browser = playwright.chromium.launch(headless=headless)
    elif browser_type == 'firefox':
        browser = playwright.firefox.launch(headless=headless)
    elif browser_type == 'webkit':
        browser = playwright.webkit.launch(headless=headless)

    context = browser.new_context(
        viewport={'width': 1920, 'height': 1080},
        user_agent='Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
    )

    page = context.new_page()

    return playwright, browser, context, page

# å¼‚æ­¥æ¨¡å¼é…ç½®
async def setup_playwright_async(browser_type='chromium', headless=False):
    """è®¾ç½®Playwrightå¼‚æ­¥æ¨¡å¼"""
    playwright = await async_playwright().start()

    if browser_type == 'chromium':
        browser = await playwright.chromium.launch(headless=headless)
    elif browser_type == 'firefox':
        browser = await playwright.firefox.launch(headless=headless)
    elif browser_type == 'webkit':
        browser = await playwright.webkit.launch(headless=headless)

    context = await browser.new_context(
        viewport={'width': 1920, 'height': 1080},
        user_agent='Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
    )

    page = await context.new_page()

    return playwright, browser, context, page
```

### é¡µé¢æ“ä½œ
```python
class PlaywrightOperations:
    def __init__(self, page):
        self.page = page

    async def navigate_to(self, url):
        """å¯¼èˆªåˆ°æŒ‡å®šURL"""
        await self.page.goto(url)
        await self.page.wait_for_load_state('networkidle')

    async def click_element(self, selector):
        """ç‚¹å‡»å…ƒç´ """
        await self.page.click(selector)

    async def input_text(self, selector, text):
        """è¾“å…¥æ–‡æœ¬"""
        await self.page.fill(selector, text)

    async def get_text(self, selector):
        """è·å–å…ƒç´ æ–‡æœ¬"""
        return await self.page.text_content(selector)

    async def get_attribute(self, selector, attribute):
        """è·å–å…ƒç´ å±æ€§"""
        return await self.page.get_attribute(selector, attribute)

    async def wait_for_element(self, selector, timeout=30000):
        """ç­‰å¾…å…ƒç´ å‡ºç°"""
        await self.page.wait_for_selector(selector, timeout=timeout)

    async def scroll_to_element(self, selector):
        """æ»šåŠ¨åˆ°å…ƒç´ """
        await self.page.scroll_into_view_if_needed(selector)

    async def take_screenshot(self, filename):
        """æˆªå›¾"""
        await self.page.screenshot(path=filename)
        print(f"æˆªå›¾å·²ä¿å­˜: {filename}")
```

## ğŸ”§ å®ç”¨å·¥å…·ç±»

### æ•°æ®æå–
```python
class DataExtractor:
    def __init__(self, driver):
        self.driver = driver

    def extract_table_data(self, table_selector):
        """æå–è¡¨æ ¼æ•°æ®"""
        table = self.driver.find_element(By.CSS_SELECTOR, table_selector)
        rows = table.find_elements(By.TAG_NAME, "tr")

        data = []
        for row in rows:
            cells = row.find_elements(By.TAG_NAME, "td")
            if cells:
                row_data = [cell.text for cell in cells]
                data.append(row_data)

        return data

    def extract_links(self, container_selector=None):
        """æå–é“¾æ¥"""
        if container_selector:
            container = self.driver.find_element(By.CSS_SELECTOR, container_selector)
            links = container.find_elements(By.TAG_NAME, "a")
        else:
            links = self.driver.find_elements(By.TAG_NAME, "a")

        link_data = []
        for link in links:
            href = link.get_attribute("href")
            text = link.text
            if href:
                link_data.append({"url": href, "text": text})

        return link_data

    def extract_images(self, container_selector=None):
        """æå–å›¾ç‰‡ä¿¡æ¯"""
        if container_selector:
            container = self.driver.find_element(By.CSS_SELECTOR, container_selector)
            images = container.find_elements(By.TAG_NAME, "img")
        else:
            images = self.driver.find_elements(By.TAG_NAME, "img")

        image_data = []
        for img in images:
            src = img.get_attribute("src")
            alt = img.get_attribute("alt")
            if src:
                image_data.append({"src": src, "alt": alt})

        return image_data
```

### è¡¨å•å¤„ç†
```python
class FormHandler:
    def __init__(self, driver):
        self.driver = driver

    def fill_form(self, form_data):
        """å¡«å†™è¡¨å•"""
        for field, value in form_data.items():
            try:
                element = self.driver.find_element(By.NAME, field)
                element.clear()
                element.send_keys(value)
            except Exception as e:
                print(f"å¡«å†™å­—æ®µ {field} å¤±è´¥: {e}")

    def select_dropdown(self, select_name, option_value):
        """é€‰æ‹©ä¸‹æ‹‰æ¡†é€‰é¡¹"""
        from selenium.webdriver.support.ui import Select

        try:
            select_element = self.driver.find_element(By.NAME, select_name)
            select = Select(select_element)
            select.select_by_value(option_value)
        except Exception as e:
            print(f"é€‰æ‹©ä¸‹æ‹‰æ¡† {select_name} å¤±è´¥: {e}")

    def submit_form(self, form_selector=None):
        """æäº¤è¡¨å•"""
        try:
            if form_selector:
                form = self.driver.find_element(By.CSS_SELECTOR, form_selector)
                form.submit()
            else:
                submit_button = self.driver.find_element(By.CSS_SELECTOR, "input[type='submit']")
                submit_button.click()
        except Exception as e:
            print(f"æäº¤è¡¨å•å¤±è´¥: {e}")
```

### ç­‰å¾…ç­–ç•¥
```python
class WaitStrategies:
    def __init__(self, driver):
        self.driver = driver
        self.wait = WebDriverWait(driver, 10)

    def wait_for_element_visible(self, locator, timeout=10):
        """ç­‰å¾…å…ƒç´ å¯è§"""
        try:
            element = WebDriverWait(self.driver, timeout).until(
                EC.visibility_of_element_located(locator)
            )
            return element
        except Exception as e:
            print(f"ç­‰å¾…å…ƒç´ å¯è§å¤±è´¥: {e}")
            return None

    def wait_for_element_clickable(self, locator, timeout=10):
        """ç­‰å¾…å…ƒç´ å¯ç‚¹å‡»"""
        try:
            element = WebDriverWait(self.driver, timeout).until(
                EC.element_to_be_clickable(locator)
            )
            return element
        except Exception as e:
            print(f"ç­‰å¾…å…ƒç´ å¯ç‚¹å‡»å¤±è´¥: {e}")
            return None

    def wait_for_text_present(self, locator, text, timeout=10):
        """ç­‰å¾…æ–‡æœ¬å‡ºç°"""
        try:
            element = WebDriverWait(self.driver, timeout).until(
                EC.text_to_be_present_in_element(locator, text)
            )
            return element
        except Exception as e:
            print(f"ç­‰å¾…æ–‡æœ¬å‡ºç°å¤±è´¥: {e}")
            return None

    def wait_for_url_contains(self, url_part, timeout=10):
        """ç­‰å¾…URLåŒ…å«æŒ‡å®šéƒ¨åˆ†"""
        try:
            WebDriverWait(self.driver, timeout).until(
                EC.url_contains(url_part)
            )
            return True
        except Exception as e:
            print(f"ç­‰å¾…URLå˜åŒ–å¤±è´¥: {e}")
            return False
```

## ğŸ§ª æµ‹è¯•æ¡†æ¶

### åŸºç¡€æµ‹è¯•ç±»
```python
import unittest
from selenium import webdriver

class WebAutomationTest(unittest.TestCase):
    def setUp(self):
        """æµ‹è¯•å‰å‡†å¤‡"""
        self.driver = setup_chrome_driver(headless=True)
        self.locator = ElementLocator(self.driver)
        self.operations = PageOperations(self.driver)

    def tearDown(self):
        """æµ‹è¯•åæ¸…ç†"""
        self.driver.quit()

    def test_page_title(self):
        """æµ‹è¯•é¡µé¢æ ‡é¢˜"""
        self.driver.get("https://www.example.com")
        title = self.driver.title
        self.assertIn("Example", title)

    def test_element_presence(self):
        """æµ‹è¯•å…ƒç´ å­˜åœ¨"""
        self.driver.get("https://www.example.com")
        element = self.locator.find_element_safe((By.TAG_NAME, "h1"))
        self.assertIsNotNone(element)

    def test_form_submission(self):
        """æµ‹è¯•è¡¨å•æäº¤"""
        self.driver.get("https://www.example.com/form")
        form_handler = FormHandler(self.driver)
        form_data = {"name": "Test User", "email": "test@example.com"}
        form_handler.fill_form(form_data)
        form_handler.submit_form()

        # éªŒè¯æäº¤ç»“æœ
        success_message = self.locator.find_element_safe((By.CLASS_NAME, "success"))
        self.assertIsNotNone(success_message)

if __name__ == '__main__':
    unittest.main()
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### æ€§èƒ½æŒ‡æ ‡æ”¶é›†
```python
class PerformanceMonitor:
    def __init__(self, driver):
        self.driver = driver

    def get_page_load_time(self):
        """è·å–é¡µé¢åŠ è½½æ—¶é—´"""
        return self.driver.execute_script(
            "return performance.timing.loadEventEnd - performance.timing.navigationStart"
        )

    def get_dom_ready_time(self):
        """è·å–DOMå‡†å¤‡æ—¶é—´"""
        return self.driver.execute_script(
            "return performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart"
        )

    def get_network_metrics(self):
        """è·å–ç½‘ç»œæŒ‡æ ‡"""
        return self.driver.execute_script("""
            var performance = window.performance;
            var network = performance.getEntriesByType('navigation')[0];
            return {
                dns: network.domainLookupEnd - network.domainLookupStart,
                tcp: network.connectEnd - network.connectStart,
                request: network.responseStart - network.requestStart,
                response: network.responseEnd - network.responseStart
            };
        """)

    def get_resource_metrics(self):
        """è·å–èµ„æºæŒ‡æ ‡"""
        return self.driver.execute_script("""
            var resources = performance.getEntriesByType('resource');
            var totalSize = 0;
            var totalTime = 0;

            resources.forEach(function(resource) {
                totalSize += resource.transferSize || 0;
                totalTime += resource.duration || 0;
            });

            return {
                totalResources: resources.length,
                totalSize: totalSize,
                totalTime: totalTime
            };
        """)
```

## ğŸ”„ ä½¿ç”¨å»ºè®®

### æœ€ä½³å®è·µ
- ä½¿ç”¨æ˜¾å¼ç­‰å¾…è€Œä¸æ˜¯éšå¼ç­‰å¾…
- åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
- ä½¿ç”¨Page Objectæ¨¡å¼ç»„ç»‡ä»£ç 
- æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†

### æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨æ— å¤´æ¨¡å¼è¿›è¡Œæµ‹è¯•
- ç¦ç”¨å›¾ç‰‡å’ŒCSSåŠ è½½
- ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜
- åˆç†è®¾ç½®å¹¶å‘æ•°

### ç»´æŠ¤å»ºè®®
- å®šæœŸæ›´æ–°æµè§ˆå™¨é©±åŠ¨
- ä½¿ç”¨ç¨³å®šçš„é€‰æ‹©å™¨
- æ·»åŠ æ—¥å¿—è®°å½•
- ç¼–å†™å¯é‡ç”¨çš„å·¥å…·å‡½æ•°

## ğŸ“ æ›´æ–°è®°å½•

### ç‰ˆæœ¬å†å²
- **v1.0** (2025-01-07): åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«åŸºç¡€è‡ªåŠ¨åŒ–é…ç½®
- **v1.1** (è®¡åˆ’ä¸­): å¢åŠ æ›´å¤šå®ç”¨å·¥å…·ç±»
- **v1.2** (è®¡åˆ’ä¸­): ä¼˜åŒ–æ€§èƒ½å’Œç¨³å®šæ€§

### è´¡çŒ®æŒ‡å—
- åˆ†äº«æœ‰æ•ˆçš„è‡ªåŠ¨åŒ–è„šæœ¬
- æä¾›ä½¿ç”¨åé¦ˆ
- å»ºè®®æ”¹è¿›æ–¹æ¡ˆ
- å‚ä¸ä»£ç å®¡æŸ¥

**æµè§ˆå™¨è‡ªåŠ¨åŒ–é…ç½®æŒç»­æ›´æ–°ä¸­...** ğŸš€
